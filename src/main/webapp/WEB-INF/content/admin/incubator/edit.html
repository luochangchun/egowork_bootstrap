<div class="content">
	<div class="tab_bar">
		<ul>
			<li class="tab_index" onclick="setTabContent(this);">编辑孵化器信息</li>
		</ul>
			<button class="btn_tabbar submit_it" onclick="mySubmitForm(this);" return="incubator/list.do?currentPageNo=1">保 存</button>
	</div>

	<form id="myForm" action="incubator/update.do" method="post">
	<input name="id" type="hidden" value="${incubator.id?c}" />
	<input name="userId" type="hidden" value="${incubator.userId!}" />
	<input type="hidden" id="label" name="label" value="${incubator.label!}"/>
	<input type="hidden" id="service" name="service" value="${incubator.service!}"/>
	<input type="hidden" id="facility" name="facility" value="${incubator.facility!}"/>
	<input type="hidden" id="enter" name="enter" value="${incubator.enter!}"/>
	<input type="hidden" id="isFree" name="isFree" value="${incubator.isFree!}"/>
	<div class="tab_content">
		<div class="tab_item tab_show">
			<table class="table_for_add">
				<tbody>
					<tr class="rowBgColor">
						<th style="width: 200px !important;">孵化器类别：</th>
						<td>
							<select id="categoryid" class="select_for_add m-l-len" name="cid">
								<@categoryTree id = 0 node = -1/>
							</select>
						</td>
						<th></th>
						<td></td>
					</tr>
					<tr>
						<th>孵化器名称： </th>
						<td>
							<i class="fa fa-asterisk text-red"></i>
							<input id="title" class="input_for_add m-l-xxs" name="title" type="text" value="${incubator.title!}" placeholder="请输入孵化器名称" /></td>
						<th></th>
						<td></td>
					</tr>
					<tr class="rowBgColor">
						<th>孵化器图标： </th>
						<td>
							<input class="input_for_add" id="icon" name="icon" type="text" readonly="readonly" value="${incubator.icon!}" style="display:none;"/>
							<div class="input_for_img m-l-len">
								<div class="img-box" data-src=""></div>
								<button type="button" class="img-btn" onclick="frameDialogShow()">上传</button>
							</div>
						</td>
						<th></th>
						<td></td>
					</tr>
					<tr>
						<th>联系人：</th>
						<td>
							<i class="fa fa-asterisk text-red"></i>
							<input type="text" class="input_for_add m-l-xxs"  name="contact" value="${incubator.contact!}"/>
						</td>
						<th></th>
						<td></td>
					</tr>
					<tr class="rowBgColor">
						<th>联系电话：</th>
						<td>
							<i class="fa fa-asterisk text-red"></i>
							<input type="text" class="input_for_add m-l-xxs"  name="phone" value="${incubator.phone!}"/></td>
						<th></th>
						<td></td>
					</tr>
					<tr>
						<th>地址：</th>
						<td><input type="text" class="input_for_add m-l-len" name="address" value="${incubator.address!}"/></td>
						<th></th>
						<td></td>
					</tr>
					<tr class="rowBgColor">
						<th>孵化器级别：</th>
						<td>
							<select id="level" class="select_for_add m-l-len" name="level">
								<@levelList/>
							</select>
						</td>
						<th></th>
						<td></td>
					</tr>
					<tr>
						<th>孵化器类型：</th>
						<td><input class="input_for_add m-l-len" name="types" type="text" value="${incubator.types}"/></td>
						<th></th>
						<td></td>
					</tr>
					<tr class="rowBgColor">
						<th>孵化器类别：</th>
						<td>
							<select id="pattern" class="select_for_add m-l-len" name="pattern">
								<option value="">---请选择---</option>
								<@patternList/>
							</select>
						</td>
						<th></th>
						<td></td>
					</tr>
					<tr>
						<th>孵化器区域：</th>
						<td>
							<select id="region" class="select_for_add m-l-len" name="region">
								<option value="">---请选择---</option>
								<@regionList/>
							</select>
						</td>
						<th></th>
						<td></td>
					</tr>
					<tr class="rowBgColor">
						<th>开放工位（元/平方米/月）：</th>
						<td><input class="input_for_add m-l-len" name="station" type="text" value="${incubator.station!}"/></td>
						<th></th>
						<td></td>
					</tr>
					<tr>
						<th>独立办公室（元/平方米/月）：</th>
						<td><input class="input_for_add m-l-len" name="office" type="text" VALUE="${incubator.office!}"/></td>
						<th></th>
						<td></td>
					</tr>
					<tr class="rowBgColor">
						<th>场地面积（平方米）：</th>
						<td><input type="text" name="area" class="input_for_add m-l-len" value="${incubator.area!}"/> </td>
						<th></th>
						<td></td>
					</tr>
					<tr>
						<th>在孵企业数：</th>
						<td><input type="text" name="enterprises" class="input_for_add m-l-len" value="${incubator.enterprises!}"/> </td>
						<th></th>
						<td></td>
					</tr>
					<tr class="rowBgColor">
						<th>入驻要求：</th>
						<td><textarea class="input_for_add m-l-len" name="settled" type="text">${incubator.settled!}</textarea></td>
						<th></th>
						<td></td>
					</tr>
					<tr>
						<th>招商政策：</th>
						<td>
							<textarea class="input_for_add m-l-len" name="policy" type="text" >${incubator.policy!}</textarea>
						</td>
						<th></th>
						<td></td>
					</tr>
					<tr class="rowBgColor">
						<th>直投基金：</th>
						<td><input class="input_for_add m-l-len" name="fund" type="text" value="${incubator.fund!}" /></td>
						<th></th>
						<td></td>
					</tr>
					<tr>
						<th>对大学生免费：</th>
						<td>
							<#if incubator.isFree == 1>
								<input class="input_for_add m-l-len" type="checkbox" name="isFrees" value="1" checked="checked"/>
							<#else>
								<input class="input_for_add m-l-len" type="checkbox" name="isFrees" value="0" />
							</#if>
						</td>
						<th></th>
						<td></td>
					</tr>
					<tr class="rowBgColor">
						<th>标签：</th>
						<td>
							<#list labels as x>
								<input class="input_for_checkbox m-l-xxl" name="labels" type="checkbox" value="${x.id!}"/>${x.value!}
							</#list>
						</td>
						<th></th>
						<td></td>
					</tr>
					<tr>
						<th>空间服务：</th>
						<td>
							<#list provides as x>
								<input class="input_for_checkbox m-l-xxl" name="services" type="checkbox" value="${x.id!}"/>${x.value!}
							</#list>
						</td>
						<th></th>
						<td></td>
					</tr>
					<tr class="rowBgColor">
						<th>配套设施：</th>
						<td>
							<#list facilities as x>
								<input class="input_for_checkbox m-l-xxl" name="facilities" type="checkbox" value="${x.id!}"/>${x.value!}
							</#list>
						</td>
						<th></th>
						<td></td>
					</tr>
					<tr>
						<th>入驻类型：</th>
						<td>
							<#list enters as x>
								<input class="input_for_checkbox m-l-xxl" name="enters" type="checkbox" value="${x.id!}" />${x.value!}
							</#list>
						</td>
						<th></th>
						<td></td>
					</tr>
					<tr class="rowBgColor">
						<th>状态：</th>
						<td>
							<#if incubator.status == 1>
								<input id="status_1" class=" m-l-len" name="status" type="radio" value="1" checked="checked"/> <label
									for="status_1">发布</label>
								<input id="status_0" name="status" type="radio" value="0"/> <label
									for="status_0">草稿</label>
								<#else>
									<input id="status_1" class=" m-l-len" name="status" type="radio" value="1"/> <label
										for="status_1">提交</label>
									<input id="status_0" name="status" type="radio" value="0" checked="checked"/> <label
										for="status_0">草稿</label>
							</#if>
						</td>
						<th></th>
						<td></td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	</form>
	<!-- 图片上传 -->
	<div id="showFrameDialog" class="frame_model fixed" style="display:none;">
		<div class="clear_zone"></div>
		<div class="frame_window" style="width:800px;margin-left:-400px; height: 500px; margin-top: -250px;">
			<div class="frame_bar">
				<span class="title">上传图片</span>
				<div class="frame_exit" onClick="frameDialogHide()"></div>
			</div>
			<div class="frame_content" style="height:464px;">
				<div class="frame_margin markdown">
					<form id="uploadForm" action="img/upload.do" method="post" enctype="multipart/form-data" onsubmit="return false;" style="margin-bottom:15px;">
						<input type="file" onChange="inputImageChange(this)" name="file" style="position:absolute;width:70px;opacity:0;"/>
						<button type="buttom" class="submit_it" style="float: inherit;">选择图片</button>
						<input id="imgSrc" name="imgSrc" type="text" style="display:none;"/>
						<button type="submit" onclick="upload(this)" class=" submit_it" style="float: inherit;">上传</button>
					</form>
					<div class="img-container" style="max-width:400px;max-height:300px;float:left;margin-right:15px;">
			          <img id="image">
			        </div>
					<div id="view" style="display:none;border: 1px solid #C8C8C8;width:300px;float:left;"></div>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
    //上传图片
    function upload(obj)
    {
        // window.editor.sync();//手动提交需要手动同步编辑器数据
        uploadForm(obj);
    }
imgChange();
$("#image").on({
    ready: function (e) {
    	getCroppedCanvas();
    },
    cropmove: function (e) {
    	getCroppedCanvas();
    },
    crop: function (e) {
    	getCroppedCanvas();
    },
    zoom: function (e) {
    	getCroppedCanvas();
    }
}).cropper(options);

    function mySubmitForm(obj)
	{
        labelChecked();
        isFreeChecked();
        submitActionForm(obj);
    }


    $('#myForm').validator({
	    // 传入字段集合
	  messages: {
		        required: "不能为空",
		    },
		    fields: {
		    	'title': 'required;title;',
		    	'contact': 'required;contact;',
		        'phone': 'required;phone;'
		    },
		    rules: {
                 phone: [/^((0\d{2,3}-\d{7,8})|(1[3584]\d{9}))$/, '手机号格式错误']
		    }

	}).on("click", ".submit_it", function(){
	    $('#myForm').trigger("submit");

	 	window.editor.sync();//手动提交需要手动同步编辑器数据
		submitActionForm(obj);

	});


    function initlabelChecked()
	{
        var label = $("#label").val();
        $("input[name='labels']:checkbox").each(function () {
            if(label.indexOf($(this).attr("value")) > -1)
				$(this).attr("checked",true);
        });

        var service = $("#service").val();
        $("input[name='services']:checkbox").each(function () {
            if(service.indexOf($(this).attr("value")) > -1)
				$(this).attr("checked",true);
        });

        var facility = $("#facility").val();
        $("input[name='facilities']:checkbox").each(function () {
            if(facility.indexOf($(this).attr("value")) > -1)
				$(this).attr("checked",true);
        });

        var enter = $("#enter").val();
        $("input[name='enters']:checkbox").each(function () {
            if(enter.indexOf($(this).attr("value")) > -1)
				$(this).attr("checked",true);
        });
    }
    initlabelChecked();

    function labelChecked() {
        var list = "";
        $("input[name='labels']:checked").each(function () {
            list += $(this).attr("value") + ",";
        });
        if (list != "") list = list.substr(0, list.length - 1);
		$("#label").val(list);

		var service = "";
        $("input[name='services']:checked").each(function () {
            service += $(this).attr("value") + ",";
		});
        if (service != "") service = service.substr(0, service.length - 1);
		$("#service").val(service);

		var facility = "";
        $("input[name='facilities']:checked").each(function () {
            facility += $(this).attr("value") + ",";
		});
        if (facility != "") facility = facility.substr(0, facility.length - 1);
		$("#facility").val(facility);

		var enter = "";
        $("input[name='enters']:checked").each(function () {
            enter += $(this).attr("value") + ",";
		});
        if (enter != "") enter = enter.substr(0, enter.length - 1);
		$("#enter").val(enter);
    }

    //设置栏目ID
	var cid = '${incubator.cid?c}';
	$("#categoryid").attr('value',cid);
</script>


<#macro categoryTree id node>
	<#local temp = node + 1 />
	<#list categorys as x>
	  	<#if id = x.pid && Session.usercategory?index_of(x.id?c) != -1>
	  	<option value="${x.id?c}"><#list 0..temp as i> &nbsp; &nbsp; </#list>├ ${x.name!}</option>
	    <@categoryTree id = x.id node=temp/>
      	</#if>
	</#list>
</#macro>

<#macro levelList>
	<#list levels as x>
		<#if incubator.level == x.id?c >
			<option value="${x.id?c}" selected>
				${x.value}
			</option>
		<#else>
			<option value="${x.id?c}">
				${x.value}
			</option>
		</#if>
	</#list>
</#macro>

<#macro patternList>
	<#list patterns as x>
		<#if incubator.pattern?? && incubator.pattern == x.id?c >
			<option value="${x.id?c}" selected>
				${x.value}
			</option>
		<#else>
			<option value="${x.id?c}">
				${x.value}
			</option>
		</#if>
	</#list>
</#macro>

<#macro regionList>
	<#list regions as x>
		<#if incubator.region?? && incubator.region == x.id?c >
			<option value="${x.id?c}" selected>
				${x.value}
			</option>
		<#else>
			<option value="${x.id?c}">
				${x.value}
			</option>
		</#if>
	</#list>
</#macro>
